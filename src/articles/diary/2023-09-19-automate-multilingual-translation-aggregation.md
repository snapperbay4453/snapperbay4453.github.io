---
title: '2023-09-19: 다국어 번역 취합 자동화'
tags: []
---

# 2023-09-19: 다국어 번역 취합 자동화


## 반복되는 업무 속에서 불편함을 의식하다

개발 프로젝트에 속하여 업무를 진행하다 보면, 코드 작성 이외에도 해야 할 일이 많다는 것을 매번 느낍니다.
그리고 그 중 몇 가지 일은 반복된 작업의 연속으로 저를 지치게 했습니다.

다국어 번역 취합은, 번역 담당자로부터 전달받은 단어 및 문장 리스트 번역 결과물을 실제 코드의 올바른 위치에 끼워넣는 업무입니다. 보통은 XLSX 확장자의 스프레드시트 파일에서 문자열을 복사한 후, 프로젝트에서 사용하는 JSON 파일에 붙여넣는 작업의 반복으로 이루어집니다.

이번 프로젝트는 지원해야 하는 언어가 상대적으로 많기도 했거니와, 번역 결과물이 자주 변경되고 그 부분만을 찾아 코드에 추가적으로 적용하는 일이 많이 발생했습니다. 이 과정에서 잘못된 문자열을 붙여넣는 등의 실수가 몇 번 발생하기도 했습니다.

어느 정도 다국어 번역 취합 작업이 완료되고 나서 잠깐의 여유를 맛보게 된 순간, 그동안의 반복된 업무에 대한 피로감이 저를 감쌌습니다. 그리고 피로감은 곧 업무에 대한 의심으로 바뀌어 갔습니다.

> 다국어 번역 취합을 반드시 이렇게 진행해야만 하나?

하지만 이 의심이 새로운 개발을 향한 열정이 될 줄은 저도 예상치 못했습니다.

> 번역 결과물을 컴퓨터가 자동으로 변환하도록 만들자!


## 업무 자동화를 위한 싹을 틔우다

업무에서 진행중이던 프로젝트 중 다수가 i18next 라이브러리를 사용하여 다국어 처리를 구현하였기 때문에, 스프레드시트 파일을 다수의 JSON 파일로 변환한 후 이를 i18next에서 인식할 수 있는 형식의 디렉터리로 구조화하는 행동을 자동화해야 했습니다.

우선은 브라우저에 업로드하여 변환 및 다운로드를 진행할 수 있는 형태로 구현하기로 하였고, 이에 맞추어 다음의 프로세스를 구상 및 구현하였습니다.

1. SheetJS 라이브러리를 통해 스프레드시트 파일을 JSON 형식으로 변환
2. JSON 데이터를 i18next에서 사용할 수 있는 형식의 디렉터리에 맞추어 조작
3. JSON 파일 및 디렉터리 생성한 후 이를 JSZip 라이브러리를 통해 압축

구현된 프로세스를 브라우저에서 동작시키기 위해 Preact를 사용하여 간단한 웹 애플리케이션을 생성하였습니다. 그리고 몇 번의 디버깅을 거친 후, XLSX 파일을 JSON 디렉터리 구조로 올바르게 변환되는 것을 확인했습니다. 희망이 생겼습니다.


## 패키지 사용자에서 오픈소스 기여자로

구현이 가능함을 실제로 확인하고 나자, 더욱 편리한 업무 자동화를 향한 열망을 가지게 되었습니다. 그동안 이루어지기를 바라기만 했던 것을, 이제는 현실로 만들 수 있을 것이라는 자신감이 생겼습니다.

* JSON 디렉토리를 압축하여 XLSX 파일로 역변환하기
* JSON 파일들을 자동으로 import 및 export할 수 있는 스크립트 파일을 추가로 생성하기
* 그리고 이것을 누구나 사용할 수 있도록 패키지로 만들어 npm에 배포하기

새로운 목표를 세우고 나자, 방금 전까지 즉흥적으로 작성했던 코드가 눈에 들어왔습니다. 분명히 동작은 하지만, 잘못 건들면 산산히 부서질 것만 같은 코드였습니다. 하지만 새로운 기능을 추가하기 위해서는 리팩토링이 필요했습니다.

열심히 작업해왔던 코드를 다시 분해해 나갔습니다. 데이터 모델을 생성하고, 흩어져 있던 로직을 모델 주변으로 한데 모았습니다. 공통적으로 사용되는 코드는 유틸리티 함수로 생성하였습니다. 그리고 웹 애플리케이션에서 import할 수 있도록 프로젝트에서 Preact를 분리하였습니다.

새로이 만들어진 패키지가 Rollup을 통해 번들링되고 그 결과물이 XLSX와 JSON ZIP 파일을 자유롭게 변환하는 것을 체크하고 나서, npm publish 명령어를 실행시켰습니다.

아직 많은 면에서 어설프고 부족했지만, 저의 첫 패키지가 배포되었습니다. 오픈소스 기여자로 한 걸음 나아갔다는 사실에 기분이 묘했습니다.


## 브라우저와 Node, ES Module과 CommonJS

하지만 아직 불편한 점이 하나 더 남아 있었습니다. 사용자는 결국 다음의 불필요한 동작을 반복해야 한다는 것이 문제였습니다.

1. 웹 애플리케이션에 XLSX 파일을 업로드합니다.
2. 변환 버튼을 클릭합니다.
3. 변환된 ZIP 파일의 압축 해제를 진행합니다.
4. 압축 해제된 디렉터리를 원하는 곳으로 이동시킵니다.

이를 해결하기 위해서는 브라우저 뿐만 아니라 다른 환경의 지원을 추가해야 했습니다. 바로 Node 환경입니다. 그리고 여기에서는 브라우저와 다른 규칙이 적용된다는 것 또한 알고 있었습니다.

그동안은 Blob 형식을 통해 파일 데이터를 다루었지만, Node 환경에서는 ArrayBuffer를 활용한 파일 조작이 좀 더 맞았습니다. 하지만 기존 로직에는 Blob 관련 코드가 강하게 결합되어 있었고, Blob 대신 ArrayBuffer를 사용하는 비슷한 로직을 새로 만드는 것은 피하고 싶었습니다.

그래서 ArrayBuffer 기반으로 코드를 리팩토링하고, 대신 브라우저 환경에서는 ArrayBuffer 형식을 Blob으로 변환하는 과정을 추가로 거치도록 했습니다. 그리고 브라우저와 Node 환경의 패키지 엔트리 포인트를 분리하였습니다.

또한 Node 환경에서는 아직 CommonJS가 우세하고 관련 생태계 또한 그러하였기 때문에, Node 환경의 엔트리 포인트는 CommonJS 형식으로 번들링되도록 했습니다.

이제 관련된 스크립트를 package.json에 저장함으로써, 명령어 하나로 XLSX 파일을 JSON 형식으로 변환하고 이를 원하는 위치에 자동으로 저장할 수 있게 되었습니다.


## 버전 1.0.0을 향하여

원하던 기능의 구현은 모두 달성했지만, 이 패키지가 안정 버전으로 나아가기까지는 아직 멀었다는 느낌이 듭니다. 타입 지정이 느슨하게 되어 있어 런타임 오류를 제대로 걸러내지 못하고 있으며, 이를 잡아줄 유닛 테스트 또한 전무합니다. 또한 번들러 최적화를 통해 패키지 크기를 줄여야 합니다.

앞으로는 최적화 진행 및 안정성의 보장을 목표로 하여 패키지를 가꾸어 나가고자 합니다. 뜬구름 잡는 것처럼 느껴지기는 하나, 더욱 완성도 있는 결과물을 위해서는 반드시 가야 할 길이라고 생각합니다.

## 패키지 링크

[https://github.com/snapperbay4453/i18n-xlsx-to-json-directory](https://github.com/snapperbay4453/i18n-xlsx-to-json-directory)
