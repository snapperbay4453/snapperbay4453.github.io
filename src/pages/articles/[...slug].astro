---
import Layout from '@/layouts/Layout.astro';
import Header from '@/composites/Header.astro';
import Markdown from '@/composites/Markdown';
import Button from '@/components/Button';
import LeftSidebarAndMain from '@/components/LeftSidebarAndMain.astro';
import VerticalBreadcrumbs from '@/components/VerticalBreadcrumbs.astro';
import WidthLimiter from '@/components/WidthLimiter.astro';
import {
  getParentPath,
  isAdjacentPath,
  getAllArticles,
  createBreadcrumbs,
} from '@/utils/pathUtil';
import type { Article } from '@/types/file';

import IconArrowBackRounded from '~icons/material-symbols/arrow-back-rounded';

export async function getStaticPaths() {
  const allArticles = getAllArticles();
  return allArticles.map(({ path, title, Content, rawContent }) => ({
    params: {
      slug: path
    },
    props: {
      pathNode: {
        path,
        parentPath: getParentPath(path),
      },
      article: {
        title,
        Content,
        rawContent,
      },
      allArticles,
    },
  }));
}

const { pathNode, article, allArticles } = Astro.props;
const adjacentArticles = allArticles.filter((currentArticle: Article) => isAdjacentPath(pathNode.path, currentArticle.path));
const breadcrumbs = createBreadcrumbs(pathNode.parentPath)
---

<Layout title='Welcome to Astro.'>
  <Header />
  <WidthLimiter>
    <LeftSidebarAndMain>
      <div slot='left-sidebar'>
        <VerticalBreadcrumbs
          basePath='/directories'
          breadcrumbs={breadcrumbs}
          client:visible
        />
      </div>
      <section>
        <Markdown
          rawContent={article.rawContent}
          client:load
        />
        
        <div class='flex justify-center items-center gap-4 mt-4'>
          <Button
            onClick={
              pathNode.path
              ? `/directories/${pathNode.parentPath}`
              : undefined
            }
            client:visible
          >
            <IconArrowBackRounded style={{ display: 'inline-block', color: 'white' }} />
            <span>뒤로가기</span>
          </Button>
        </div>
      </section>
    </LeftSidebarAndMain>
  </WidthLimiter>
</Layout>
